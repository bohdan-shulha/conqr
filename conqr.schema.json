{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Conqr Configuration File",
  "description": "Configuration file for conqr - a dead-simple TUI process runner",
  "type": "object",
  "$defs": {
    "RestartConfig": {
      "type": "object",
      "description": "Configuration for automatic process restart behavior",
      "properties": {
        "policy": {
          "type": "string",
          "enum": ["never", "on-error", "on-exit"],
          "description": "Restart policy: 'never' (no auto-restart), 'on-error' (restart only on non-zero exit), or 'on-exit' (restart on any exit)"
        },
        "delay": {
          "type": "integer",
          "minimum": 0,
          "description": "Time in milliseconds to wait before attempting a restart"
        }
      },
      "additionalProperties": false
    }
  },
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for IDE validation"
    },
    "restart": {
      "$ref": "#/$defs/RestartConfig",
      "description": "Global restart configuration applied to all commands by default"
    },
    "commands": {
      "description": "Commands to run concurrently as an object with name-command pairs.",
      "type": "object",
      "patternProperties": {
        "^.+$": {
          "oneOf": [
            {
              "type": "string",
              "description": "Simple command: the command string to execute. The key is used as the display name."
            },
            {
              "type": "object",
              "description": "Extended command: object with command and optional restart configuration.",
              "properties": {
                "command": {
                  "type": "string",
                  "description": "The command string to execute"
                },
                "restart": {
                  "$ref": "#/$defs/RestartConfig",
                  "description": "Per-process restart configuration that overrides global settings"
                }
              },
              "required": ["command"],
              "additionalProperties": false
            }
          ]
        }
      },
      "additionalProperties": false,
      "minProperties": 1
    }
  },
  "required": ["commands"],
  "additionalProperties": false,
  "examples": [
    {
      "$comment": "Example 1: Simple commands only (string values)",
      "commands": {
        "Dev Server": "npm run dev",
        "Build Process": "npm run build",
        "Worker": "npm run worker"
      }
    },
    {
      "$comment": "Example 2: Extended commands only (object values with command property)",
      "commands": {
        "Dev Server": {
          "command": "npm run dev"
        },
        "Build Process": {
          "command": "npm run build"
        },
        "Worker": {
          "command": "npm run worker",
          "restart": {
            "policy": "on-error"
          }
        }
      }
    },
    {
      "$comment": "Example 3: Mixed simple and extended commands",
      "commands": {
        "Dev Server": "npm run dev",
        "Build Process": {
          "command": "npm run build"
        },
        "Worker": {
          "command": "npm run worker",
          "restart": {
            "policy": "on-error",
            "delay": 3000
          }
        }
      }
    },
    {
      "$comment": "Example 4: With global restart config",
      "restart": {
        "policy": "on-error",
        "delay": 2000
      },
      "commands": {
        "Dev Server": "npm run dev",
        "Worker": "npm run worker"
      }
    },
    {
      "$comment": "Example 5: With per-process restart config overriding global",
      "restart": {
        "policy": "on-error",
        "delay": 2000
      },
      "commands": {
        "Dev Server": "npm run dev",
        "Worker": {
          "command": "npm run worker",
          "restart": {
            "policy": "on-exit",
            "delay": 5000
          }
        }
      }
    }
  ]
}
